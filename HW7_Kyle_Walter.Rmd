---
title: "Homework 7"
author: "Kyle Walter"
date: "5/30/2021"
output:
  word_document: default
  html_document: default
---
# Homework number: 7





## Question 3:
 Run cor.test() on the correlation between "area" and "perm" in the rock data set
 and interpret the results. Note that you will have to use the "$" accessor to get
 at each of the two variables. Make sure you interpret both the confidence 
 interval and the p-value that is generated by cor.test().

```{r}

library(BayesFactor)
data(rock)
#View(rock)
```

Capture just the area and perm values

```{r}
rock.areas <- rock$area
rock.perms <- rock$perm
```

Run a correlation t-test on the values. 

```{r}
cor.test(rock.areas, rock.perms)
```

Answer 3:
The null hypthoesis is that we would not expect correlation between the rocks area and its permeability After running the the correlation test we can see that the p value is less than .05, in addition we see that the confidence interval runs from -0.61 to -0.127. As we believe the confidence interval is somewhere in this range, we would expect that the population mean does not contain zero thus we would reject the null the hypothesis and note that there is statistical correlation between the two values. There is a negative correlation betwee the rocks..

## Question 4:
  Create a copy of the bfCorTest() custom function presented in this chapter.
Don't forget to "source" it. Conduct a Bayesian analysis of the correlation 
between "area" and "perm" in the rock data set.

bfCorTest function found in the textbook and async material. 
```{r}
bfCorTest <- function (x,y) # Get r from BayesFactor
{
  zx <- scale(x) # Standardize X
  zy <- scale(y) # Standardize Y
  zData <- data.frame(x=zx,rhoNot0=zy) # Put in a data frame
  bfOut <- generalTestBF(x ~ rhoNot0, data=zData) # linear coefficient
  mcmcOut <- posterior(bfOut,iterations=10000) # posterior samples
  print(summary(mcmcOut[,"rhoNot0"])) # Get the HDI for rho
  return(bfOut) # Return Bayes factor object
}

bfCorTest(rock.areas, rock.perms)
```



Answer 4:

We can see from the Bayes Test that the -.347 also support the correlation from question three that the two are negatively correlated. The quantile values, similiar to the confidence interval do not pass through zero also supporting the test from ealier though the range is getting closer to zero on the 97.5% tail. The Rhonot is at a value of 8.07 to 1 which is greater than 3 to 1 test. This also supports that there is correlation and the ability to conclude that there is statistical evidence that the two are not independent.


## Question 8:
   Not unexpectedly, there is a data set in R that contains these data. The data set
 is called UCBAdmissions and you can access the department mentioned above like
 this: UCBAdmissions[,,1]. Make sure you put two commas before the 1: this is a 
 three dimensional contingency table that we are subsetting down to two dimensions.
 Run chisqp.test() on this subset of the data set and make sense of the results.

Make 2 x 2 table function from the book.
```{r}
make2x2table <- function(ul)
{
  ll <- 50 - ul
  ur <- 30 - ul
  lr <- 50 - ur
  matrix(c(ul,ur,ll,lr),nrow=2, ncol=2, byrow = T)
}
```


Calc chi squared function from the book. 
```{r}
calcChiSquared <- function(actual,expected)
{
  diffs <- actual - expected
  diffsSq <- diffs^2
  diffsSqNorm <- diffsSq/expected
  sum(diffsSqNorm)
}
```

Play with the table maker. 
```{r}
make2x2table(15)
calcChiSquared(make2x2table(15), make2x2table(15))
```


Run a chi squared test
```{r}
chisq.test(UCBAdmissions[,,1], correct=F)
```


Answer 8:

The null hypothesis is that the gender and admission decision are independent of each other. The large Chisquared value of 17.248 and the low p-value less than 0.05 and significantly smaller provides support to reject the null hypothesis and conclude that gender and admission are not independent of each other.

## Question 9:
  Use the contingencyTableBF() to conduct a Bayes factor analysis on the UCB
admissions data. Report and interpret the Bayes factor.

Run a Bayesian analysis of the gender and admissions data.
```{r}
ucbOut <- contingencyTableBF(UCBAdmissions[,,1],sampleType="poisson", posterior=F)
summary(ucbOut)
```

Answer 9:
  Similar to answer for question 8, the null hypothesis is that both gender and admission are independent of each other. With a bayes factor of 1111.64 to 1 which is greater than the 3 to 1 test, we would conclude that there is significant support for the alternative hyptohesis and the conclude that based on the data gender and admisson are not independent of each other.


## Question 10:
  Using the UCBA data, run contingencyTableBF() with posterior sampling. Use the 
results to calculate a 95% HDI of the difference in proportions between the 
columns.

Run a Bayesian analysis of the gender and admissions data.
Include posterior probability
```{r}
ucbOut <- contingencyTableBF(UCBAdmissions[,,1], sampleType="poisson", 
                             posterior=T, iterations = 10000)
```

Calculate admission status proportions for males
```{r}
maleProp <- ucbOut[,"lambda[1,1]"]/ucbOut[,"lambda[2,1]"]
hist(maleProp)
```


Calculate admission status proportions for females
```{r}
femaleProp <- ucbOut[,"lambda[1,2]"]/ucbOut[,"lambda[2,2]"]
hist(femaleProp)
```


Calculate the difference between males and females
```{r}
propDiffs <- maleProp - femaleProp
```

# Plot the differences and include the 95% HDI lines.
```{r}
hist(propDiffs, 
     main="Histogram of Proportion Differences - Male vs. Female", 
     col="darkslategray4", xlab="DIfference")
abline(v=quantile(propDiffs,c(0.025)), col="black")
abline(v=quantile(propDiffs,c(0.975)), col="black")
```



Print the HDI interval
```{r}
c(quantile(propDiffs,c(0.025)),quantile(propDiffs,c(0.975)))
```
Print the median
```{r}
quantile(propDiffs, c(.5))
```



Answer 10:
Continuing on from question 9, we looked at the population variance between males and females. First plotting the HDI ranges of the males which centers between 1.6 and 1.65. The range runs from 1.4 to 2. Fales conversely show a population centered between 4 and 5 and ranging from 2 to 14. We then ran the population mean difference between males and females and see that that range runs from -6 to -1.21. The mean reaches a peak mean difference of -2.914 and does not contain zero with in the data range. Thus there is continued support that that populations are not independent.